<!DOCTYPE html>
<html lang="en">

    <!-- CSS from here: ---------------------------------------------------------------------------------------------------------------------------------- -->

<style>

 /* Replacing default types, like body and input*/ 
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background-color: #f5f5f5;
}

input[type="text"] {
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    width: 200px;
    margin-right: 10px;
}

button {
    padding: 8px 12px;
    border: none;
    border-radius: 4px;
    background-color: #007bff;
    color: white;
    cursor: pointer;
}

 /* Defining a type of class, thus it needs to start with "." */ 
.container {
    text-align: left;
    background-color: #ffffff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.popupWindow {
    position: fixed;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    opacity: 0;
    visibility: hidden;
    transform: scale(1.1);
    transition: visibility 0s linear 0.25s, opacity 0.25s 0s, transform 0.25s;
}

.popupWindow-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    padding: 1rem 1.5rem;
    width: 24rem;
    border-radius: 0.5rem;
}

.show-popupWindow {
    opacity: 1;
    visibility: visible;
    transform: scale(1.0);
    transition: visibility 0s linear 0s, opacity 0.25s 0s, transform 0.25s;
}

.input-Error {
    background-color: #f75252;
}


</style>





<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campsite registration</title>

</head>


<body>


<!-- HTML (The M part) from here:  ---------------------------------------------------------------------------------------------------------------------------------- -->


    <div class="container">
            <!-- Popup window, hidden at the start -->
            <div id="PopupWindow" class="popupWindow" > 

                <div class = "popupWindow-content">   <!-- TODO, combine the two div classes if possible -->
                    <p>Your entry have been registered</p>
                    <button id="ClosePupupWindowButton">Ok</button>
                </div>
            </div>


            <h1>Campsite registration</h1>

            <table>
                <tr> 
                    <!-- Buttens style set to nothing, so they are not generated at the start -->
                    <td> <button id="DownloadButton" style="display: none;">Download CSV file</button> </td>
                    <td> <button id="DeleteButton" style="display: none;">Delete local storage</button> </td>
                </tr>

                <tr>
                    <td>First and middle names:</td>
                    <td><input type="text" id="FirstNameInput" placeholder="First and middle names"></td>
                    <td> <p id="FirstNameInputHelpText"> </td>
                </tr>

                <tr>
                    <td>Last names:</td>
                    <td><input type="text" id="LastNameInput" placeholder="Last names"></td>
                    <td> <p id="LastNameInputHelpText"> </td>
                </tr>

                <tr>
                    <td>Street name and number:</td>
                    <td><input type="text" id="StreetInput" placeholder="Street name and number"></td>
                    <td> <p id="StreetInputHelpText"> </td>
                </tr>

                <tr>
                    <td>Zipcode:</td>
                    <td><input type="text" id="ZipcodeInput" placeholder="Zipcode"></td>
                    <td> <p id="ZipcodeInputHelpText"> </td>
                </tr>

                <tr>
                    <td>Town:</td>
                    <td><input type="text" id="TownInput" placeholder="Town"></td>
                    <td> <p id="TownInputHelpText"> </td>
                </tr>

                <tr>
                    <td>Nationality:</td>
                    <td><input type="text" id="NationalityInput" placeholder="Nationality"></td>
                    <td> <p id="NationalityInputHelpText"> </td>
                </tr>

                <tr>
                    <td>Number of Adults:</td>
                    <td><input type="text" id="AdultsInput" placeholder="Number of Adults"></td>
                    <td> <p id="AdultsInputHelpText"> </td>
                </tr>

                <tr>
                    <td>Number of Children:</td>
                    <td><input type="text" id="ChildrenInput" placeholder="Number of Children"></td>
                    <td> <p id="ChildrenInputHelpText"> </td>
                </tr>

                <tr>
                    <td><button id="SaveButton">Save</button></td>
                </tr>

            </table>


        <h5> TODO: information required by GDPR about what we will use this info for </h5>

    </div>



    <!-- Javascript from here:  ---------------------------------------------------------------------------------------------------------------------------------- -->

    <script>

        const localStorageKey = "localStorageKey";

        // - - - - - - - - - - All event listeners:

        // Everytime the text changes in the first textbox, check if the secret word have been typed
        FirstNameInput.addEventListener('input', (event) => {
        if(FirstNameInput.value.trim().toUpperCase() === "EXCEL")
        {
            // Set style.display value to block.
            // For other values to set it to, see https://www.w3schools.com/jsref/prop_style_display.asp
            DownloadButton.style.display = 'block';
            DeleteButton.style.display = 'block';
        }
        else
        {
            DownloadButton.style.display = 'none';
            DeleteButton.style.display = 'none';
        }

        });


        SaveButton.addEventListener('click', () => {

            // Take all text input and put them into an array in the order
            // we want it to apear in the CVS file
            let singleInput = [];

            let someUserInputAreWrong = false;



            // - - - - - Have all the input checked
            // Check the inputs from least to most General, since only last error text will apear

            // - FirstNameInput
            // Must not contain numbers
            if( containsNumber( FirstNameInput.value.trim() ) )
            {
                FirstNameInput.classList.add("input-Error");
                FirstNameInputHelpText.innerHTML = " <- May not contain numbers";
                someUserInputAreWrong = true;
            }

            // Must not be empty
            else if( FirstNameInput.value.trim() === "" )
            {
                FirstNameInput.classList.add("input-Error");
                FirstNameInputHelpText.innerHTML = " <- Must be filled out";
                someUserInputAreWrong = true;
            }

            else
            {
                FirstNameInput.classList.remove("input-Error");
                FirstNameInputHelpText.innerHTML = "";
            }





            // - LastNameInput
            // Must not contain numbers
            if( containsNumber( LastNameInput.value.trim() ) )
            {
                LastNameInput.classList.add("input-Error");
                LastNameInputHelpText.innerHTML = " <- May not contain numbers";
                someUserInputAreWrong = true;
            }

            // Must not be empty
            else if( LastNameInput.value.trim() === "")
            {
                LastNameInput.classList.add("input-Error");
                LastNameInputHelpText.innerHTML = " <- Must be filled out";
                someUserInputAreWrong = true;
            }

            else
            {
                LastNameInput.classList.remove("input-Error");
                LastNameInputHelpText.innerHTML = "";
            }





            // - StreetInput
            // Must not be empty
            if( StreetInput.value.trim() === "")
            {
                StreetInput.classList.add("input-Error");
                StreetInputHelpText.innerHTML = " <- Must be filled out";
                someUserInputAreWrong = true;
            }
            else
            {
                StreetInput.classList.remove("input-Error");
                StreetInputHelpText.innerHTML = "";
            }





            // - ZipcodeInput
            // Must contain numbers
            if( containsNumber( ZipcodeInput.value.trim() ) === false )
            {
                ZipcodeInput.classList.add("input-Error");
                ZipcodeInputHelpText.innerHTML = " <- Must contain numbers";
                someUserInputAreWrong = true;
            }

            // Must not be empty
            else if( ZipcodeInput.value.trim() === "")
            {
                ZipcodeInput.classList.add("input-Error");
                ZipcodeInputHelpText.innerHTML = " <- Must be filled out";
                someUserInputAreWrong = true;
            }
            else
            {
                ZipcodeInput.classList.remove("input-Error");
                ZipcodeInputHelpText.innerHTML = "";
            }





            // - TownInput
            // Must not contain numbers
            if( containsNumber( TownInput.value.trim() ) )
            {
                TownInput.classList.add("input-Error");
                TownInputHelpText.innerHTML = " <- May not contain numbers";
                someUserInputAreWrong = true;
            }

            // Must not be empty
            else if( TownInput.value.trim() === "")
            {
                TownInput.classList.add("input-Error");
                TownInputHelpText.innerHTML = " <- Must be filled out";
                someUserInputAreWrong = true;
            }
            else
            {
                TownInput.classList.remove("input-Error");
                TownInputHelpText.innerHTML = "";
            }





            // - NationalityInput
            // Must not contain numbers
            if( containsNumber( NationalityInput.value.trim() ) )
            {
                NationalityInput.classList.add("input-Error");
                NationalityInputHelpText.innerHTML = " <- May not contain numbers";
                someUserInputAreWrong = true;
            }

            // Must not be empty
            else if( NationalityInput.value.trim() === "")
            {
                NationalityInput.classList.add("input-Error");
                NationalityInputHelpText.innerHTML = " <- Must be filled out";
                someUserInputAreWrong = true;
            }
            else
            {
                NationalityInput.classList.remove("input-Error");
                NationalityInputHelpText.innerHTML = "";
            }



            var temp = parseInt( AdultsInput.value.trim() );

            // - AdultsInput
            // Must be a number between 0 and 500
            if( parseInt( AdultsInput.value.trim() ) < 0 || parseInt( AdultsInput.value.trim() ) > 500)
            {
                AdultsInput.classList.add("input-Error");
                AdultsInputHelpText.innerHTML = " <- Must be a number between 0 and 500";
                someUserInputAreWrong = true;
            }

            // Must only contain numbers
            else if( containsOnlyNumbers( AdultsInput.value.trim() ) === false )
            {
                AdultsInput.classList.add("input-Error");
                AdultsInputHelpText.innerHTML = " <- Must only contain numbers";
                someUserInputAreWrong = true;
            }

            // Must not be empty
            else if( AdultsInput.value.trim() === "")
            {
                AdultsInput.classList.add("input-Error");
                AdultsInputHelpText.innerHTML = " <- Must be filled out";
                someUserInputAreWrong = true;
            }
            else
            {
                AdultsInput.classList.remove("input-Error");
                AdultsInputHelpText.innerHTML = "";
            }





            // - ChildrenInput
            // Must be a number between 0 and 500
            if( parseInt( ChildrenInput.value.trim() ) < 0 || parseInt( ChildrenInput.value.trim() ) > 500)
            {
                ChildrenInput.classList.add("input-Error");
                ChildrenInputHelpText.innerHTML = " <- Must be a number between 0 and 500";
                someUserInputAreWrong = true;
            }

            // Must only contain numbers
            else if( containsOnlyNumbers( ChildrenInput.value.trim() ) === false )
            {
                ChildrenInput.classList.add("input-Error");
                ChildrenInputHelpText.innerHTML = " <- Must only contain numbers";
                someUserInputAreWrong = true;
            }

            // Must not be empty
            else if( ChildrenInput.value.trim() === "")
            {
                ChildrenInput.classList.add("input-Error");
                ChildrenInputHelpText.innerHTML = " <- Must be filled out";
                someUserInputAreWrong = true;
            }
            else
            {
                ChildrenInput.classList.remove("input-Error");
                ChildrenInputHelpText.innerHTML = "";
            }





            if(someUserInputAreWrong)
            {
                // return without saving the inputs
                return;
            }

            singleInput.push( FirstNameInput.value.trim() );
            singleInput.push( LastNameInput.value.trim() );
            singleInput.push( StreetInput.value.trim() );
            singleInput.push( ZipcodeInput.value.trim() + " " + TownInput.value.trim() );
            singleInput.push( NationalityInput.value.trim() );
            singleInput.push( AdultsInput.value.trim() );
            singleInput.push( ChildrenInput.value.trim() );

            // Make a giant string of all values in the array, seperated by commas and ending with a newline (IE, be a CVS string)
            const aEntry = singleInput.join(',') + '\n';


            // Get the handler to the local storage
            let allEntries = localStorage.getItem(localStorageKey);

            if(allEntries === null)
            {
                allEntries = "";
            }

            allEntries = allEntries + aEntry; // add entry
            localStorage.setItem(localStorageKey, allEntries) // save

            PopupWindow.classList.add("show-popupWindow");

        });


        DownloadButton.addEventListener('click', () => {


            let allEntries = localStorage.getItem(localStorageKey);


            const csvContent = "data:text/csv;charset=utf-8," + allEntries;
            const encodedUri = encodeURI(csvContent);

            const link = document.createElement("a"); // TODO try to remove. I think it is not needed

            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "Campsite_Registrations.csv");

            document.body.appendChild(link);

            link.click();

        });



        DeleteButton.addEventListener('click', () => {
            localStorage.removeItem(localStorageKey);
            FirstNameInput.value = '';
            DownloadButton.style.display = 'none';
            DeleteButton.style.display = 'none';
        });


        ClosePupupWindowButton.addEventListener('click', () => {

            // Clear the current text in the input fields, so it is ready for next entry
            FirstNameInput.value = '';
            LastNameInput.value = '';
            StreetInput.value = '';
            TownInput.value = '';
            ZipcodeInput.value = '';
            NationalityInput.value = '';
            AdultsInput.value = '';
            ChildrenInput.value = '';

            PopupWindow.classList.remove("show-popupWindow");


        });


        // - - - - - - - - - - All helper functions:




        function containsNumber(myString) {
            return /\d/.test(myString);
        }

        function containsOnlyNumbers(myString) {
            return /^\d+$/.test(myString);
        }

    </script>



</body>



</html>
